---
name: mcp-server-health-ops
description: "MCPサーバー運用時のヘルスチェックと異常回収を標準化するスキル。ゾンビ化、孤立プロセス、ポート競合、応答停止を検知し、安全に停止・再起動して健全性を回復する。トリガー: MCPサーバー, ゾンビ, 応答しない, ポート競合, ヘルスチェック。"
---

# MCP Server Health Ops

## Goal

MCPサーバーの運用異常を早期検知し、再発しにくい形で回収する。

## When To Use

- MCPサーバーが応答しない
- 起動はしているがセッション作成に失敗する
- 旧プロセスが残留している疑いがある
- ポート競合や不安定起動が続く

## Workflow

1. 健全性の初期判定
- `/status` 応答可否
- 対象ポートの LISTEN 状態
- 稼働プロセスの PID と起動引数

2. 異常分類
- `zombie/orphan`: 親子関係不整合や取り残し
- `port-conflict`: 既存プロセスがポート占有
- `half-alive`: プロセス存在するが `/status` 不達
- `config-drift`: 起動設定と実際の実行引数が不一致

3. 安全な回収
- 影響プロセスを特定し、対象限定で停止する。
- 停止後にポート解放を確認する。
- 同一設定で再起動し、PID・ポート・`/status`を再検証する。

4. 再発防止
- 起動コマンドの単一化（テンプレ化）
- ヘルスチェックの定期確認項目を残す
- 失敗時の即時確認コマンドを runbook 化する

## Retry Policy

- 一時失敗の再試行は最大3回。
- 3回失敗時は「異常分類・実行ログ・未解決点」を整理してエスカレーション。

## Output Format

- 現在状態（PID/Port/Status）
- 異常分類
- 回収手順と結果
- 再発防止策
- 次回同症状時の実行順

## Guardrails

- 非対象プロセスは停止しない。
- 破壊的操作を行う前に、対象PIDと目的を明示する。
- 既存の `sandbox-escalation` ルールに従う。
