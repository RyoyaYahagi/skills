---
description: 会話内容やartifactを基に、作業内容をNotionの「antigravity 日記」に記録するワークフロー
---

# Notion Diary Workflow

このワークフローは、本日の作業内容を要約し、Notionの「antigravity 日記」ページおよびプロジェクト別の詳細ページに記録します。

## 事前準備
1.  **作業内容の要約とプロジェクト特定**:
    - **メインページ用**: 作業全体のハイライトを1〜2行の要約として作成する。
    - **サブページ用**: `task.md` のチェックリスト項目、変更した具体的なファイル名、重要な技術的決定事項を含む**詳細な作業ログ**を作成する。以下の情報を含めること：
        - 完了した具体的なタスク（`task.md` ベース）
        - 修正・作成した主要ファイル
        - 直面した課題とその解決策
    - プロジェクト名（例: `todo-swiftui`）でNotion内を検索（`mcp_notion-mcp-server_API-post-search`）。
    - ページが見つかればその `id` と `url` を取得。見つからなければ新規作成し取得する。

## 手順

// turbo
1. **作業内容の要約とプロジェクト特定**:
    - userの `task.md` や直近の成果を基に、以下の2種類の内容を準備する:
        1. **要約（メインページ用）**: 作業全体のハイライト（1行程度）。
        2. **詳細ログ（サブページ用）**: 完了したタスク、変更したファイル名、重要な決定事項を含む詳細なリスト。
    - プロジェクト名（例: `todo-swiftui`）でNotion内を検索（`mcp_notion-mcp-server_API-post-search`）。
    - ページが見つかればその `id` と `url` を取得。見つからなければ新規作成し取得する。

// turbo
2. **メインページ（antigravity 日記）への追記**:
    - メインページ ID: `2d2af1c6-ee15-806b-8526-d8022c7e99ff`
    - **プロパティ更新**: `mcp_notion-mcp-server_API-patch-page` を使用して、`作成日` プロパティ (`properties: {"作成日": {"date": {"start": "YYYY-MM-DD"}}}`) を本日の日付（現在時刻のJST日付）に更新する。
    - `mcp_notion-mcp-server_API-get-block-children` で本日の日付ヘッダーを確認、なければ作成。
    - ステップ1で取得したURLを用いて、プロジェクト名と概要を箇条書きで追加。
    - **重要**: リンクは正しいRich Text形式（`{"text": {"content": "プロジェクト名", "link": {"url": "..."}}}`）で作成すること。
    - **禁止**: `content` フィールドに HTMLタグ（`<a>`など）やMarkdownリンク記法（`[]()`）を含めてはならない。純粋なテキストのみを記述すること。

// turbo
3. **プロジェクト別サブ（詳細）ページの更新**:
    - ステップ1で特定したサブページ内にて、アンカーブロック（Divider、種類: `divider`）が最上部にあるか確認。
    - なければ、ページの最上部にDividerブロックを作成し、そのIDをアンカーIDとする。
    - あれば、その最上部のDividerブロックのIDをアンカーIDとする。
    - 本日の日付のトグルリストを作成し、`after: アンカーID` パラメータを指定して追加する（これにより常に新しい日付が上に来る）。
    - トグルリストの中に、ステップ1で準備した**詳細ログ**（箇条書き）を追加。ファイル名や具体的な変更点を含め、後で振り返った際に文脈がわかるようにする。

## 注意事項
- **差分最小化**: 既存の記録を上書きせず、末尾に追記すること。
- **Fail-fast**: ページの取得に失敗した場合は、エラーメッセージをログに出力して中断する。
- **日本語記述**: UI文字列や内容はすべて日本語で行う。
