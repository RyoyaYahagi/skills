# ワークフロー詳細ガイド

## テンプレートプロンプト集

### Research フェーズ

```
このフォルダを深く読み込み、仕組みを徹底的に理解してください。
全ての詳細と特殊なケースを把握した上で、発見事項を research.md に詳細に記録してください。
```

```
[対象システム]を詳細に調査し、その仕組みの細部まで理解してください。
全てを把握したら research.md に詳細なレポートを書いてください。
```

```
[対象フロー]を徹底的に調べ、潜在的なバグを探してください。
全てのバグを見つけるまで調査を続け、見つけ次第 research.md に詳細レポートを書いてください。
```

**ポイント**: 「深く」「徹底的に」「細部まで」等の強調語を使う。省略するとAIは表面的な調査で済ませる傾向がある。

### Planning フェーズ

```
[機能名・説明]を実装したいです。[ビジネス成果]を実現するためにシステムを拡張します。
実装方法の詳細な plan.md を作成してください。コードスニペットを含めてください。
```

```
[変更内容]を実現する詳細な plan.md を書いてください。
変更を提案する前にソースファイルを実際に読み、コードベースの実態に基づいた計画にしてください。
```

### Annotation Cycle

```
ドキュメントにいくつか注釈を追加しました。
全ての注釈に対応し、ドキュメントを更新してください。まだ実装はしないでください。
```

### Todo List

```
計画に詳細なTodoリストを追加してください。
全フェーズと個々のタスクを含めてください。まだ実装はしないでください。
```

### Implementation

```
全て実装してください。タスクやフェーズが完了したら plan.md で完了マークを付けてください。
全タスク・全フェーズの完了まで停止しないでください。
不要なコメントやJSDocは追加せず、型チェックを継続的に実行してください。
```

## 注釈サイクルのベストプラクティス

### 効果的な注釈の書き方

| 種類           | 例                                    | 効果                   |
| -------------- | ------------------------------------- | ---------------------- |
| 技術選択の修正 | `"drizzle:generate使って、生SQL禁止"` | ドメイン知識の注入     |
| アプローチ却下 | `"このセクション削除"`                | スコープの制御         |
| 制約の追加     | `"この3関数のシグネチャは変更禁止"`   | インターフェース保護   |
| 簡潔な修正     | `"任意ではなく必須"`                  | 素早い修正             |
| 方向性の転換   | `"スキーマ構造を再設計して..."`       | セクション全体の再構成 |
| スコープ削減   | `"ダウンロード機能は計画から削除"`    | スコープクリープ防止   |

### ラウンド数の目安

- **1-2回**: 小規模な修正、明確な要件
- **3-4回**: 中規模の機能、複数の設計判断が必要
- **5-6回**: 大規模な変更、ドメイン知識の注入が多い

### アンチパターン

- ❌ チャットで口頭指示だけで計画を修正しようとする
- ❌ 注釈を全て一度に説明しようとする（ドキュメントに直接書く方が正確）
- ❌ 計画が不完全なまま実装に進む
- ❌ 「だいたいOK」で実装を開始する（OKか否かの二択）

## セッション管理

### 単一セッション推奨

Research → Planning → Annotation → Implementation を1つの長いセッションで実行する。
セッションを分割すると、調査フェーズで蓄積したコンテキストが失われる。

### コンテキスト保全

plan.md はセッション中のコンテキスト圧縮（auto-compaction）を生き延びる永続的なアーティファクトとして機能する。チャット履歴が圧縮されても、plan.md を参照すれば全ての決定事項を復元できる。
